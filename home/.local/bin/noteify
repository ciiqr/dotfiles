#!/usr/bin/env bash

set -e

. ~/.scripts/lib/output.sh

get_prefix() {
    declare string="$1"
    declare i=0

    # skip whitespace
    for (( ; i < ${#string}; i++)); do
        if [[ "${string:$i:1}" != *[$' \t']* ]]; then
            break
        fi
    done

    # collect prefix
    declare prefix=''
    for (( ; i < ${#string}; i++)); do
        if [[ "${string:$i:1}" == *[$' \t']* ]]; then
            break
        fi
        prefix+="${string:$i:1}"
    done

    # print prefix
    echo "$prefix"
}

declare file="${1:-/dev/stdin}"

while IFS= read -r line; do
    declare prefix
    prefix="$(get_prefix "$line")"

    case "$prefix" in
        '#')
            output::echo '242' "$line"
            ;;
        '%')
            output::echo 'yellow' "$line"
            ;;
        'x')
            output::echo 'green' "$line"
            ;;
        '-')
            output::echo '208' "$line"
            ;;
        '?')
            output::echo '117' "$line"
            ;;
        '~')
            output::echo '117' "$line"
            ;;
        '!')
            output::echo 'red' "$line"
            ;;
        '!!')
            output::echo 'white,bold,bg::red' "$line"
            ;;
        *)
            echo "$line"
            ;;
    esac
done <"$file"
