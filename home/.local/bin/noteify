#!/usr/bin/env bash

set -e

. ~/.scripts/lib/output.sh

declare file="${1:-/dev/stdin}"

while IFS= read -r line; do
    declare prefix
    prefix="$(sed -nE 's/^[ \t]*(#|%|x|-|\?|~|!|!!) .*/\1/p' <<<"$line")"

    case "$prefix" in
        '#')
            output::echo '242' "$line"
            ;;
        '%')
            output::echo 'yellow' "$line"
            ;;
        'x')
            output::echo 'green' "$line"
            ;;
        '-')
            output::echo '208' "$line"
            ;;
        '?')
            output::echo '117' "$line"
            ;;
        '~')
            output::echo '117' "$line"
            ;;
        '!')
            output::echo 'red' "$line"
            ;;
        '!!')
            output::echo 'white,bold,bg::red' "$line"
            ;;
        *)
            echo "$line"
            ;;
    esac
done <"$file"
