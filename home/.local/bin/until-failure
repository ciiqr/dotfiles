#!/usr/bin/env bash

# TODO: fix so this is fine
# set -e

. ~/.scripts/lib/output.sh

declare ret_code=0
declare temp
temp="$(mktemp)"
declare count=0

while [[ "$ret_code" == "0" ]]; do
    "$@" >"$temp" 2>&1
    ret_code="$?"

    clear
    cat "$temp"
    if [[ "$temp" != *$'\n' ]]; then
        echo
    fi

    if [[ "$ret_code" == "0" ]]; then
        ((count++))
        output::success -n "${count} runs without failure"
        echo ": " "$@"
    fi
done

output::failure -n "${count} runs without failure"
echo ": " "$@"
