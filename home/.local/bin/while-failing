#!/usr/bin/env bash

# TODO: fix so this is fine
# set -e

. ~/.scripts/lib/output.sh

declare ret_code=1
declare temp
temp="$(mktemp)"
declare count=0

while [[ "$ret_code" != '0' ]]; do
    "$@" >"$temp" 2>&1
    ret_code="$?"

    clear
    cat "$temp"

    if [[ "$ret_code" != '0' ]]; then
        ((count++))
        output::failure -n "${count} runs without success"
        echo ":" "$@"
    fi
done

output::success -n "${count} runs without success"
echo ":" "$@"
